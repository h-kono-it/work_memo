# 帳票印刷ソリューション

## 課題

10種類の帳票を出力

HTML10種類+aくらいのイメージ

ググった手法がニーズに合わなかった

## HMTL+CSS

PDF化はブラウザの印刷機能

バッチならヘッドレスブラウザ

### つらい

細かいデザインを再現するのがめんどくさい

A4一枚で収まるレイアウトと縦スクロール前提で動作するレイアウトで作り方が違う

表のcolspan, rowでなんとかするのしんどい

=> ビジュアルツールが必要

### Excelで作ってヘッドレスモード

PDFへの変換はLibreOffice利用

ヘッドレスモードでCLIでExcelからPDFにできる

帳票の細かなデザインをExcelを再現しようとするとめちゃくちゃな方眼紙を作らないといけない

ExcelからPDFで見た目が崩れる、MacとWindowsで出力結果が違う

### 外部サービスを使う

SVF：エンプラ製品は高すぎて無理

月額1万円以下のサービスであっても中小企業だと追加のランニングコストは難しい

## 条件確認

- ミリ単位の調整
- ビジュアルデザイン
- 印刷時に崩れない

## アイデア

- Figmaでデザイン
- プレースホルダー
- SVGでエクスポート
- SVGをHTMLを入れてCSSで調整
- 動的にプレースホルダーを埋め込み

PDF2SVGでSVG作れる

- pathではなくtextにする
- text要素にid要素をつける

文字参照に注意：Figmaはデフォルトでエンコードされる

デコードが必要

## 追加の対応

- テキストの自動縮小
  - textLengthをレンダリング後に設定
- 右寄せ、左寄せ
  - text-ancor
- 自動折り返し
  - 枠の幅でテキストを改行
  - font-sizeを変更して再試行

## おわりに

- ブログ見てね
- npmパッケージ化済み

連票は？：1ページ、2ページ、3ページ以上のテンプレートを作っておく
