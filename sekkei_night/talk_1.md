# ロジックから状態を分離する技術 わいとん

## 純粋関数

入力が同じなら出力が常に同じ、副作用が生じない

純粋関数だと

- テストが容易
- 流用が容易
  - 状態がないため再利用しやすい
- 分離が容易
  - フレームワークやORMと結合しない

結果として、メンテナンス性が高く、教育、改造が容易

容易である：誰もがコミットできるシステム

## やらないこと

### メンバー変数、カプセル化はやらない

インスタンスの内部を予想しながらコード書くのはコストが高い=>内部に値がなければカプセル化も不要

### データとロジックの混在

Row型は良いがデータを持つだけにしたい

継承の妨げになる

### 継承

クラス継承、型継承

継承元を知らないといけない、ロジックが分断されている

多世代継承するとどこで処理が行われているかわからない

## 副作用を扱う層を分離する

### MVCにおけるFatModel問題

modelを分離

- Service
  - 状態管理
  - ビジネスロジック
- Infra
  - DB接続

Serviceを分離

- UseCase
  - ビジネスロジック
- Service
  - 状態管理
- Infra
  - DB接続
 
循環参照しそうなので一方通行にする

## ビジネスロジックから純粋関数を分離

- 純粋関数にするもの
  - 計算
  - フォーマット
  - 入れ替え
- 複数の条件

↑協議のビジネスロジック=Domain、これはUsecase、Serviceから呼べる

## テスト以外のメリット

状態に関する考慮を軽減

## 純粋関数デザパタ

勝手に作成

- 条件関数
- スイッチ関数
- テンプレート関数
- データ構築
  - 構造体を作る